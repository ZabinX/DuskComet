<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>DuskCheerpJ test</title>
    <script src="https://cjrtnc.leaningtech.com/20250618_2540/loader.js"></script>
  </head>
  <body>
<script>
  (async function () {
    try {
      // 1. Initialize CheerpJ. We don't need mounts for this method.
      await cheerpjInit();
      cheerpjCreateDisplay(1280, 720);

      // 2. Manually fetch the JAR file from its URL.
      //    The './' is important to ensure it looks in the same directory.
      const response = await fetch('./duskclient.jar');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const jarData = await response.arrayBuffer();

      // 3. Explicitly add the fetched JAR data to CheerpJ's virtual filesystem.
      //    We are creating the /app/ directory and putting the file inside it.
      await cheerpjAddStringFile("/app/", "duskclient.jar", new Uint8Array(jarData));

      // 4. Run the JAR from its new, confirmed location in the virtual filesystem.
      await cheerpjRunJar("/app/duskclient.jar");

      // 5. Connect to the game server.
      await cheerpjRunMain("Dusk", "dusk.coat-richter.ts.net", "443");

    } catch (error) {
      // If anything goes wrong, log it to the console for debugging.
      console.error("CheerpJ startup error:", error);
    }
  })();
</script>
  </body>
</html>
