<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>DuskCheerpJ test</title>
    <script src="https://cjrtnc.leaningtech.com/20250618_2540/loader.js"></script>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        overflow: hidden; /* Prevent scrollbars */
        background: black;
      }
      #cheerpj-container {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="cheerpj-container"></div>
    <script>
      (async function () {
        try {
          // Fetch the ephemeral Tailscale auth key from the backend service.
          const response = await fetch("/api/get-key", { method: "POST" });
          if (!response.ok) {
            throw new Error(`Failed to get auth key: ${response.statusText}`);
          }
          const data = await response.json();
          const tailscaleAuthKey = data.key;

          // Initialize CheerPJ with the fetched key.
          await cheerpjInit({
            tailscaleAuthKey: tailscaleAuthKey,
          });

          const container = document.getElementById('cheerpj-container');
          cheerpjCreateDisplay(-1, -1, container);
          await cheerpjRunJar("/app/duskclient.jar");

        } catch (error) {
          console.error("Error during initialization:", error);
          // Display an error message to the user.
          const body = document.querySelector("body");
          body.innerHTML = `<h1>Error</h1><p>Could not connect to the game server. Please try again later.</p>`;
        }
      })();
    </script>
  </body>
</html>



